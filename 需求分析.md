# 台股清單進入處置需求分析

## 目標
建立一個網站，顯示明天可能會進入處置的台股清單。

## 資料來源
1. [台灣證券交易所公告](https://www.twse.com.tw/zh/announcement/notice.html)
2. [櫃買中心公告](https://www.tpex.org.tw/zh-tw/announce/market/attention.html)
3. 法規條件參考：
   - [法規條件1](https://www.rootlaw.com.tw/LawArticle.aspx?LawID=A040390051040300-1131231)
   - [法規條件2](https://www.rootlaw.com.tw/LawArticle.aspx?LawID=A040390051040500-1140711)
4. [進入處置的規則](https://twse-regulation.twse.com.tw/m/LawContent.aspx?FID=FL007225)

## 邏輯規則
1. 若股票再被注意一次，則進入處置。
2. 注意條件如附圖所示：
   - 條件根據法規條件1、2，若前幾天已被注意數次，今天再被注意，隔天即進入處置。

## 功能需求
1. 爬取上述網站的資料。
2. 根據規則判斷哪些股票可能進入處置。
3. 顯示清單，包含股票代碼、名稱、漲跌幅、成交量等資訊。

## 技術需求
1. **後端**：負責爬取資料、處理邏輯。
2. **前端**：顯示清單，提供簡潔的介面。
3. **資料更新**：每日更新，顯示明天可能進入處置的股票。

## 其他考量
1. 爬取資料需注意反爬機制。
2. 法規條件可能會更新，需設計靈活的邏輯以便未來擴展。

## 下一步
1. 爬蟲的技術選擇（如 Python 的 `requests` 或 `BeautifulSoup`）。
2. 後端框架（如 Flask 或 Django）。
3. 前端框架（如 React 或 Vue.js）。
4. 資料庫設計（如 MySQL 或 SQLite）。

## Acceptance Criteria

### 爬取資料
- **Given** 使用者開啟網站
- **When** 系統每日執行爬蟲，從指定的公告網站獲取資料
- **Then** 資料應包含股票代碼、名稱、根據第幾款被注意幾次等資訊，並存入資料庫。

### 個股資料
- **Given** 使用者開啟網站
- **When** 若現在為台股開盤時間獲取個股即時資料，否則用歷史最新的資料
- **Then** 資料應包含股票代碼、名稱、漲跌幅、成交量等注意條件相關資訊，並存入資料庫。

### 判斷進入處置
- **Given** 股票已被注意數次
- **When** 系統根據法規條件1、2進行判斷，且今日再被注意
- **Then** 該股票應被標記為明天進入處置。

### 顯示清單
- **Given** 使用者瀏覽網站
- **When** 系統更新清單
- **Then** 使用者應能看到包含股票代碼、名稱、漲跌幅、成交量的明天有可能進入處置的股票清單。

### 資料更新
- **Given** 系統每日執行更新
- **When** 新的公告資料被爬取並處理
- **Then** 清單應反映最新的注意條件和進入處置的股票。

### 個股狀態顯示
- **Given** 系統判斷個股是否符合注意條件
- **When** 個股觸發第幾款條件
- **Then** 若觸發條件，該個股顯示紅色，表示明天進入處置；否則顯示綠色，表示明天不會進處置。

## 已處置清單需求

### 目標
顯示已處置的股票清單，並與待處置清單分開管理。

### 功能需求
1. **後端**：
   - 提供 API 服務，檢查股票是否已處置。
   - 整合 `punished_stocks.db`，返回已處置的股票清單。

2. **前端**：
   - 新增 `disposed-container` 區域，顯示已處置的股票清單。
   - 點擊已處置的股票卡片，顯示詳細資訊。

3. **資料庫**：
   - 使用 `punished_stocks.db` 儲存已處置的股票清單。

4. **自動化排程**：
   - 每日更新已處置清單，確保資料同步。

### 技術需求
1. **後端技術**：
   - Flask：處理 API 請求。
   - SQLite：管理 `punished_stocks.db` 資料庫。
   - APScheduler：每日更新已處置清單。

2. **前端技術**：
   - HTML：新增已處置清單的顯示區域。
   - JavaScript：
     - 動態渲染已處置的股票卡片。
     - 點擊卡片顯示詳細資訊。

### 使用檔案
1. **後端**：
   - `src/api.py`：
     - 修改 `/potential_disposals` API，檢查 `punished_stocks.db`，返回 `已處置` 標記。
     - 提供已處置清單的 API。

2. **前端**：
   - `src/templates/index.html`：
     - 新增 `disposed-container` 區域。
     - 使用 JavaScript 動態渲染已處置的股票清單。

3. **資料庫**：
   - `punished_stocks.db`：
     - 儲存已處置的股票清單。

4. **自動化排程**：
   - APScheduler：每日更新 `punished_stocks.db`，確保資料同步。

## 使用檔案與邏輯

### 後端
1. **`src/api.py`** ：
   - 提供 API 服務，包括：
     - `/stocks`：返回所有股票的基本資訊。
     - `/stocks/<stock_id>`：返回指定股票的詳細資訊。
     - `/stocks/<stock_id>/conditions`：返回指定股票符合的處置條件。
     - `/potential_disposals`：返回可能進入處置的股票清單，並檢查是否已處置。
   - 使用 `notice_stocks.db` 儲存所有股票的交易資訊。
   - 使用 `punished_stocks.db` 檢查已處置的股票清單。

2. **`src/get_stock_notice_infos.py`** ：
   - 爬取台灣證券交易所與櫃買中心的公告資料。

3. **`src/notice_info_to_df.py`** ：
   - 將公告資料轉換為 DataFrame，並儲存至資料庫。

4. **`src/get_trading_date.py`** ：
   - 管理交易日資訊，提供最近 n 個交易日的範圍。

### 前端
1. **`src/templates/index.html`** ：
   - 顯示待處置與已處置的股票清單。
   - 提供詳細資訊顯示，包括觸發的條件。
   - 使用 JavaScript 動態渲染卡片：
     - `card-container`：顯示待處置的股票清單。
     - `disposed-container`：顯示已處置的股票清單。

### 資料庫
1. **`notice_stocks.db`** ：
   - 儲存所有股票的交易資訊。

2. **`punished_stocks.db`** ：
   - 儲存已處置的股票清單。

### 自動化排程
1. **APScheduler** ：
   - 每日 0:00 自動執行資料更新腳本。
   - 更新公告資料與交易日資訊。
